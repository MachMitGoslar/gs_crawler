# Docker Compose Configurations

This project provides different Docker Compose configurations for different use cases:

## Available Configurations

### 1. `compose.yaml` (Production)
**Purpose:** Production deployment using pre-built images from GitHub Container Registry

**Features:**
- Uses pre-built images from `ghcr.io/stuffdev/gs_crawler_*:latest`
- Automatically updated by CI/CD pipeline
- No local build required
- Faster startup times

**Usage:**
```bash
# Pull latest images and run
docker-compose pull
docker-compose up -d

# Or run directly
docker-compose up -d
```

### 2. `compose.dev.yaml` (Development)
**Purpose:** Local development with live builds

**Features:**
- Builds images locally from source
- Uses local Dockerfiles and base images
- Ideal for development and testing changes
- Slower startup (needs to build images)

**Usage:**
```bash
# Build and run development environment
docker-compose -f compose.dev.yaml build
docker-compose -f compose.dev.yaml up -d

# Or build and run in one command
docker-compose -f compose.dev.yaml up -d --build
```

### 3. `compose.production.yaml` (Generated)
**Purpose:** Auto-generated production configuration with specific versions

**Features:**
- Generated by CI/CD pipeline
- Uses specific version tags (not `:latest`)
- Includes deployment metadata
- Version-locked for reproducible deployments

**Usage:**
```bash
# Use the generated production file (created by CI/CD)
docker-compose -f compose.production.yaml up -d
```

## Container Images

### Production Images (compose.yaml)
Images are built and pushed by the GitHub Actions workflow in `.github/workflows/container-instances-deploy.yml`.

**Image Pattern:**
```
ghcr.io/stuffdev/gs_crawler_[container-name]:latest
```

**Examples:**
- `ghcr.io/stuffdev/gs_crawler_000_health_monitor:latest`
- `ghcr.io/stuffdev/gs_crawler_001_senioren:latest`
- `ghcr.io/stuffdev/gs_crawler_002_ferienpass:latest`

### Development Images (compose.dev.yaml)
Built locally using the Dockerfiles in `docker_instances/*/Dockerfile`.

## CI/CD Integration

### Automatic Updates
When code is pushed to `main` branch:
1. GitHub Actions builds new container images
2. Images are pushed to GitHub Container Registry
3. `compose.production.yaml` is generated with specific version tags
4. Production deployment can pull latest images automatically

### Base Images
The system uses shared base images to reduce redundancy:
- `gs_crawler/python_basic_crawler`
- `gs_crawler/python_selenium_crawler`
- `gs_crawler/php_basic_crawler`
- `gs_crawler/flask_monitor`

## Deployment Strategies

### Quick Production Deployment
```bash
# Use latest images
docker-compose up -d
```

### Development Workflow
```bash
# Make changes to code
# Build and test locally
docker-compose -f compose.dev.yaml up -d --build

# Test your changes
# Push to main branch
# CI/CD will automatically build and push new images
```

### Version-Specific Deployment
```bash
# Use CI/CD generated file with specific versions
docker-compose -f compose.production.yaml up -d
```

## Health Monitoring

The Health Monitor is available at:
- **Production:** http://localhost:5015
- **Development:** http://localhost:5015

## Output Directory

All crawlers write their output to:
```
./httpdocs/crawler/
```

This directory is mounted as a volume in all containers and is shared between all services.
